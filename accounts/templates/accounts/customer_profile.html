{% extends "base.html" %}

{% block title %}My Profile â€” Organic Store{% endblock title %}

{% block extra_head %}
<style>
    .profile-container {
        padding: 60px 0;
        max-width: 1000px;
        margin: auto;
    }

    .profile-title {
        font-family: 'Caveat', cursive;
        color: var(--organic-dark);
        font-size: 2.6rem;
        margin-bottom: 40px;
        text-align: center;
    }

    .profile-card {
        background: #ffffffd9;
        border-radius: 18px;
        padding: 30px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
        transition: 0.2s;
    }

    .profile-card:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    .section-title {
        font-family: 'Caveat', cursive;
        font-size: 1.9rem;
        color: var(--organic-dark);
        margin-bottom: 20px;
        border-bottom: 2px solid var(--organic-primary);
        padding-bottom: 5px;
    }

    /* Flex layout for addresses + map/form */
    .addresses-map-container {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
    }

    .addresses-column {
        flex: 1;
        min-width: 280px;
    }

    .map-column {
        flex: 2;
        min-width: 320px;
    }

    .address-list {
        margin-bottom: 20px;
    }

    .address-item {
        padding: 15px 18px;
        background: #f2f9f2;
        border-radius: 12px;
        margin-bottom: 12px;
        display: flex;
        flex-direction: column;
        font-size: 0.95rem;
        color: #3e6b3e;
        position: relative;
    }

    .address-item span {
        margin-bottom: 5px;
    }

    .btn-show-map {
        background-color: var(--organic-primary);
        color: #fff;
        border-radius: 10px;
        padding: 6px 16px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: 0.2s;
        align-self: flex-start;
        margin-top: 5px;
    }

    .btn-show-map:hover {
        background-color: var(--organic-dark);
    }

    .btn-delete-address {
        background-color: red;
        color: #fff;
        border-radius: 10px;
        padding: 6px 16px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: 0.2s;
        align-self: flex-start;
        margin-top: 5px;
    }

    #map {
        height: 400px;
        border-radius: 15px;
        margin-bottom: 15px;
    }

    .btn-save {
        background-color: var(--organic-primary);
        color: #fff;
        border-radius: 10px;
        padding: 8px 26px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: 0.2s;
    }

    .btn-save:hover {
        background-color: var(--organic-dark);
    }

    @media (max-width: 768px) {
        .addresses-map-container {
            flex-direction: column;
        }
    }
</style>
{% endblock extra_head %}

{% block content %}
<section class="container">
    <h2 class="profile-title">My Profile</h2>

    <!-- BASIC INFO -->
    <div class="profile-card">
        <h3 class="section-title">Basic Information</h3>

        <div class="profile-item">
            <strong>Name:</strong> {{ request.user.get_full_name }}
        </div>

        <div class="profile-item">
            <strong>Email:</strong> {{ request.user.email }}
        </div>
    </div>

    <!-- HOME ADDRESSES + MAP -->
    <div class="profile-card">
        <h3 class="section-title">Home Addresses</h3>

        <div class="addresses-map-container">
            <!-- Addresses List -->
            <div class="addresses-column">
                {% if addresses %}
                <div class="address-list">
                    {% for address in addresses %}
                    <div class="address-item">
                        <span><strong>Name:</strong> {{ address.full_name }}</span>
                        <span><strong>Phone:</strong> {{ address.phone }}</span>
                        <span><strong>Address:</strong> {{ address.address_line }}, {{ address.city }}</span>
                        <span><strong>Postal Code:</strong> {{ address.postal_code }}</span>
                        {% if address.latitude and address.longitude %}
                        <span><strong>Coordinates:</strong> {{ address.latitude }}, {{ address.longitude }}</span>
                        {% endif %}
                        {% if address.last_location_update %}
                        <span><strong>Last Updated:</strong> {{ address.last_location_update|date:"M d, Y H:i" }}</span>
                        {% endif %}
                        {% if address.latitude and address.longitude %}
                        <div class="d-flex gap-2">
                            <button type="button" class="btn-show-map"
                                onclick="showOnMap({{ address.latitude }}, {{ address.longitude }})">
                                Show on Map
                            </button>
                            <form action="" method="post">
                                {% csrf_token %}
                                <button type="submit" class="btn-delete-address"
                                    onclick="return window.confirm('Are you sure to delete the address?')">
                                    Delete
                                </button>

                            </form>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p>No addresses saved yet.</p>
                {% endif %}
            </div>

            <!-- Map + Form -->
            <div class="map-column">
                {% include 'accounts/map.html' %}
            </div>
        </div>
    </div>
</section>
{% endblock content %}